<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Browser CORS policy | Simon's Blog</title><meta name=keywords content="CORS Policy,Cross Origin"><meta name=description content="Intuition To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?
Imagine there&rsquo;s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API&rsquo;s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: &ldquo;https://bank-site-a."><meta name=author content="Suowei Hu"><link rel=canonical href=https://blog.simon-hu.org/posts/2023.11.08-browser-cors-policy-and-csrf-attack/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.89e7a3cfb9906f56d1ff70930818833a11ce408c7bcab0b72a35ffe53439a75c.css integrity="sha256-ieejz7mQb1bR/3CTCBiDOhHOQIx7yrC3KjX/5TQ5p1w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.simon-hu.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.simon-hu.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.simon-hu.org/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.simon-hu.org/apple-touch-icon.png><link rel=mask-icon href=https://blog.simon-hu.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Browser CORS policy"><meta property="og:description" content="Intuition To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?
Imagine there&rsquo;s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API&rsquo;s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: &ldquo;https://bank-site-a."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.simon-hu.org/posts/2023.11.08-browser-cors-policy-and-csrf-attack/"><meta property="og:image" content="https://blog.simon-hu.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="og:site_name" content="Simon's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.simon-hu.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Browser CORS policy"><meta name=twitter:description content="Intuition To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?
Imagine there&rsquo;s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API&rsquo;s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: &ldquo;https://bank-site-a."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.simon-hu.org/posts/"},{"@type":"ListItem","position":2,"name":"Browser CORS policy","item":"https://blog.simon-hu.org/posts/2023.11.08-browser-cors-policy-and-csrf-attack/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Browser CORS policy","name":"Browser CORS policy","description":"Intuition To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?\nImagine there\u0026rsquo;s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API\u0026rsquo;s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: \u0026ldquo;https://bank-site-a.","keywords":["CORS Policy","Cross Origin"],"articleBody":"Intuition To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?\nImagine there’s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API’s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: “https://bank-site-a.com/api?from=account1\u0026to=account2”. If without any security policy, the phishing site B can copy this exact link and place it on some easily found buttons or links, and once a user (with logged in bank account) clicks on these buttons or links, the transaction will be triggered without the user’s permission.\nSuch attack forces authenticated users to submit a request to a Web application against which they are currently authenticated, is called Cross-Site Request Forgery (CSRF).\nAnd the CORS (Cross-Origin Resource Sharing) policy is here to prevent this ! It will allow controlled access to resources from different origins/domain names in web browsers, ensuring security and protecting against cross-site scripting attacks.\nExample CORS Request Type ? The CORS request will be preflighted (preflight request sent) in the following cases:\n1 2 3 - Non-simple request methods: If the request method is other than GET, POST, or HEAD, a preflight request is sent. - Custom request headers: If the request includes custom headers (apart from a few allowed headers like `Accept`, `Accept-Language`, `Content-Language`, `Content-Type`, etc.), a preflight request is sent. - Content-Type header: If the ﻿Content-Type header value is outside the allowed values for simple requests, a preflight request is sent. For all other cases, the request is considered a simple request, and no preflight request is needed\nCORS Simple Request Suppose a user visits http://www.example.com and the page attempts a cross-origin request to fetch data from http://service.example.com. A CORS-compatible browser will attempt to make a cross-origin request to service.example.com as follows.\nThe browser ends request with Origin header to service.example.com: 1 Origin: http://www.example.com The server at service.example.com sends one of these three responses: 1 2 3 A) wild-card: Access-Control-Allow-Origin: * B) with-origin: Access-Control-Allow-Origin: http://www.example.com C) disallow: Access-Control-Allow-Origin: none CORS Preflight Request When performing certain types of cross-domain Ajax requests, modern browsers that support CORS will initiate an extra “preflight” request to determine whether they have permission to perform the action. Cross-origin requests are preflighted this way because they may have implications to user data.\n1 2 3 4 OPTIONS / Host: service.example.com Origin: http://www.example.com Access-Control-Request-Method: PUT If service.example.com is willing to accept the action, it may respond with the following headers:\n1 2 Access-Control-Allow-Origin: http://www.example.com Access-Control-Allow-Methods: PUT The browser will then make the actual request. If service.example.com does not accept cross-site requests from this origin then it will respond with error to the OPTIONS request and the browser will not make the actual request.\nResolving Cross-Origin Issue From time to time we will have to face the condition where we need to access some portion of the site from another site (for instance: reading font-face or script, fetching data using ajax), and in that scenario, we will need to bypass the Cross-Origin constraint by CORS policy. And we can resolve this via two methods: making the two sites under the same domain (using reverse proxy like apache or nginx), or add the parent site (origin) into the access-allow-origin header of the child site (target).\nMethod-1: Reverse Proxy The first method involves using a reverse proxy router, mapping two sites of the different domain to a different URI of the same domain. For instance we can map “www.proxy.com/site-1” to “www.example.com”, “www.proxy.com/site-2” to “www.services.com”, and replace the original URL (in the “www.example.com”) from “www.services.com” to “www.proxy.com/site-2\". Then from the point-of-view of the browser, they are now under the same domain hence will not trigger the CORS policy.\nMethod-2: Add Origin Header The second method involves making modification at the service (side of server), in order for the browser to permit CORS access, the receiver will need to have origin’s origin in the “access-allow-origin” header; For instance, “www.example.com” initiates the request with header “origin:www.example.com” to server “www.service.com”, we will need to put header “access-allow-origin:www.example.com” for every relating request response from “www.service.com”.\nReference-1: Wikipedia - Cross-origin resource sharing Reference-2: Bilibili - 底搞懂CORS（跨域资源共享 ","wordCount":"725","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Suowei Hu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.simon-hu.org/posts/2023.11.08-browser-cors-policy-and-csrf-attack/"},"publisher":{"@type":"Organization","name":"Simon's Blog","logo":{"@type":"ImageObject","url":"https://blog.simon-hu.org/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.simon-hu.org/ accesskey=h title="Simon's Blog (Alt + H)">Simon's Blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://blog.simon-hu.org/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.simon-hu.org/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://blog.simon-hu.org/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Browser CORS policy</h1><div class=post-meta>4 min&nbsp;·&nbsp;725 words&nbsp;·&nbsp;Suowei Hu&nbsp;|&nbsp;<a href=https://github.com/SuoweiHu/SuoweiHu.github.io/content/posts/2023.11.08%20browser%20cors%20policy%20and%20csrf%20attack.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=post-content><h2 id=intuition>Intuition<a hidden class=anchor aria-hidden=true href=#intuition>#</a></h2><p><strong>To begin with we need to answer a simple question, why do we need to block traffic from one site to another site, and have everything controlled in this CORS policy ?</strong></p><blockquote><p>Imagine there&rsquo;s two site, site A is a legitimate banking website that provides online finance services, site B is a phishing website that tries to spoof the website A. As a developer you might be aware of API&rsquo;s, and the legitimate banking website is using exactly that to transfer money from account to account, for instance: &ldquo;<code>https://bank-site-a.com/api?from=account1&amp;to=account2</code>&rdquo;. If without any security policy, the phishing site B can copy this exact link and place it on some easily found buttons or links, and once a user (with logged in bank account) clicks on these buttons or links, the transaction will be triggered without the user&rsquo;s permission.</p></blockquote><blockquote><p>Such attack forces authenticated users to submit a request to a Web application against which they are currently authenticated, is called <strong>Cross-Site Request Forgery (CSRF)</strong>.</p></blockquote><p><img loading=lazy src=../2023.11.08%20browser%20cors%20policy%20and%20csrf%20attack/images/2023.11.08%20-%20173520.jpg alt="2023.11.08 - 173520"></p><p><strong>And the CORS (Cross-Origin Resource Sharing) policy is here to prevent this ! It will allow controlled access to resources from different origins/domain names in web browsers, ensuring security and protecting against cross-site scripting attacks.</strong></p><hr><h2 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h2><h3 id=cors-request-type->CORS Request Type ?<a hidden class=anchor aria-hidden=true href=#cors-request-type->#</a></h3><p>The CORS request will be preflighted (preflight request sent) in the following cases:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=o>-</span><span class=w> </span><span class=n>Non</span><span class=o>-</span><span class=n>simple</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=n>methods</span><span class=p>:</span><span class=w>    </span><span class=k>If</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>other</span><span class=w> </span><span class=n>than</span><span class=w> </span><span class=n>GET</span><span class=p>,</span><span class=w> </span><span class=n>POST</span><span class=p>,</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>HEAD</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>preflight</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>sent</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=w> </span><span class=n>Custom</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=n>headers</span><span class=p>:</span><span class=w>        </span><span class=k>If</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=n>includes</span><span class=w> </span><span class=n>custom</span><span class=w> </span><span class=nf>headers</span><span class=w> </span><span class=p>(</span><span class=n>apart</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>few</span><span class=w> </span><span class=n>allowed</span><span class=w> </span><span class=n>headers</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=o>`</span><span class=n>Accept</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>Accept</span><span class=o>-</span><span class=n>Language</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>Content</span><span class=o>-</span><span class=n>Language</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=n>etc</span><span class=p>.),</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>preflight</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>sent</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>-</span><span class=w> </span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=w> </span><span class=n>header</span><span class=p>:</span><span class=w>           </span><span class=k>If</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=err>﻿</span><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=w> </span><span class=n>header</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>outside</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>allowed</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>simple</span><span class=w> </span><span class=n>requests</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>preflight</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>sent</span><span class=p>.</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>For <strong>all other cases</strong>, the request is considered a simple request, and no preflight request is needed</p><h3 id=cors-simple-request>CORS Simple Request<a hidden class=anchor aria-hidden=true href=#cors-simple-request>#</a></h3><p>Suppose a user visits <code>http://www.example.com</code> and the page attempts a cross-origin request to fetch data from <code>http://service.example.com</code>. A CORS-compatible browser will attempt to make a cross-origin request to service.example.com as follows.</p><ol><li>The browser ends request with Origin header to <code>service.example.com</code>:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Origin: http://www.example.com
</span></span></code></pre></td></tr></table></div></div></li><li>The server at <code>service.example.com</code> sends one of these three responses:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>A) wild-card:     Access-Control-Allow-Origin: *
</span></span><span class=line><span class=cl>B) with-origin:   Access-Control-Allow-Origin: http://www.example.com
</span></span><span class=line><span class=cl>C) disallow:      Access-Control-Allow-Origin: none
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=cors-preflight-request>CORS Preflight Request<a hidden class=anchor aria-hidden=true href=#cors-preflight-request>#</a></h3><p>When performing certain types of cross-domain Ajax requests, modern browsers that support CORS will initiate an extra &ldquo;<strong>preflight</strong>&rdquo; request to determine whether they have permission to perform the action. Cross-origin requests are preflighted this way because they may have implications to user data.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>OPTIONS /
</span></span><span class=line><span class=cl>Host:                          service.example.com
</span></span><span class=line><span class=cl>Origin:                        http://www.example.com
</span></span><span class=line><span class=cl>Access-Control-Request-Method: PUT
</span></span></code></pre></td></tr></table></div></div><p>If service.example.com is willing to accept the action, it may respond with the following headers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Access-Control-Allow-Origin:   http://www.example.com
</span></span><span class=line><span class=cl>Access-Control-Allow-Methods:  PUT
</span></span></code></pre></td></tr></table></div></div><p>The browser will then make the actual request. If <code>service.example.com</code> does not accept cross-site requests from this origin then it will respond with error to the OPTIONS request and the browser will not make the actual request.</p><hr><h2 id=resolving-cross-origin-issue>Resolving Cross-Origin Issue<a hidden class=anchor aria-hidden=true href=#resolving-cross-origin-issue>#</a></h2><p>From time to time we will have to face the condition where we need to access some portion of the site from another site (for instance: reading font-face or script, fetching data using ajax), and in that scenario, we will need to bypass the Cross-Origin constraint by CORS policy. And we can resolve this via two methods: making the two sites under the same domain (using reverse proxy like apache or nginx), or add the parent site (origin) into the access-allow-origin header of the child site (target).</p><h3 id=method-1-reverse-proxy>Method-1: Reverse Proxy<a hidden class=anchor aria-hidden=true href=#method-1-reverse-proxy>#</a></h3><p>The first method involves using a <strong>reverse proxy router</strong>, mapping two sites of the different domain to a different URI of the same domain. For instance we can map &ldquo;<code>www.proxy.com/site-1</code>&rdquo; to &ldquo;<code>www.example.com</code>&rdquo;, &ldquo;<code>www.proxy.com/site-2</code>&rdquo; to &ldquo;<code>www.services.com</code>&rdquo;, and replace the original URL (in the &ldquo;<code>www.example.com</code>&rdquo;) from &ldquo;<code>www.services.com</code>&rdquo; to &ldquo;w<code>ww.proxy.com/site-2"</code>. Then from the point-of-view of the browser, they are now <strong>under the same domain</strong> hence will not trigger the CORS policy.</p><p><img loading=lazy src=../2023.11.08%20browser%20cors%20policy%20and%20csrf%20attack/images/2023.11.08%20-%20173649.jpg alt="2023.11.08 - 173649"></p><h3 id=method-2-add-origin-header>Method-2: Add Origin Header<a hidden class=anchor aria-hidden=true href=#method-2-add-origin-header>#</a></h3><p>The second method involves making <strong>modification at the service</strong> (side of server), in order for the browser to permit CORS access, the receiver will need to have origin&rsquo;s origin in the &ldquo;access-allow-origin&rdquo; header; For instance, &ldquo;<code>www.example.com</code>&rdquo; initiates the request with header &ldquo;<code>origin:www.example.com</code>&rdquo; to server &ldquo;<code>www.service.com</code>&rdquo;, we will need to put header &ldquo;<code>access-allow-origin:www.example.com</code>&rdquo; for every relating request response from &ldquo;<code>www.service.com</code>&rdquo;.</p><p><img loading=lazy src=../2023.11.08%20browser%20cors%20policy%20and%20csrf%20attack/images/2023.11.08%20-%20174442.png alt="2023.11.08 - 174442"></p><hr><blockquote><p>Reference-1: <a href=https://en.wikipedia.org/wiki/Cross-origin_resource_sharing>Wikipedia - Cross-origin resource sharing</a>
Reference-2: <a href=https://www.bilibili.com/video/BV13z4y1F717>Bilibili - 底搞懂CORS（跨域资源共享</a></p></blockquote><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.simon-hu.org/tags/cors-policy/>CORS Policy</a></li><li><a href=https://blog.simon-hu.org/tags/cross-origin/>Cross Origin</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.simon-hu.org/>Simon's Blog</a></span><br><span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>